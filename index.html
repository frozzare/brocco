<!DOCTYPE html>
<meta charset="utf-8">
<link rel="stylesheet" href="docco.css">
<title>brocco.js</title>
<div id="docs"></div>
<script src="showdown.js"></script>
<script src="brocco.js"></script>
<script>
function getFiles(files, cb) {
  var contents = {};
  files.forEach(function(filename) {
    var req = new XMLHttpRequest();
    req.open("GET", filename);
    req.onload = function() {
      contents[filename] = req.responseText;
      if (Object.keys(contents).length == files.length)
        cb(contents);
    };
    req.send(null);
  });
}

getFiles(["brocco.jst", "brocco.js"], function(contents) {
  Brocco.document("brocco.js", contents["brocco.js"], {
    showdown: new Showdown.converter(),
    template: Brocco.template(contents["brocco.jst"]),
    highlightSyntax: function(language, code, cb) {
      var div = document.createElement('div');
      div.appendChild(document.createTextNode(code));
      var result = '<div class="highlight"><pre>' +
                   div.innerHTML +
                   '</pre></div>\n';
      var parts = result.split(language.dividerText);
      var html = parts.join('\n<span class="c">' + language.symbol + 
                            'DIVIDER</span>\n');
      cb(html);
    }
  }, function(html) {
    document.getElementById("docs").innerHTML = html;
  });
});
</script>
