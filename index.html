<!DOCTYPE html>
<meta charset="utf-8">
<link rel="stylesheet" href="docco.css">
<title>brocco.js</title>
<div id="docs"></div>
<script src="showdown.js"></script>
<script src="brocco.js"></script>
<script>
var FILE_CONTENTS = {};
var FILES = [
  "brocco.jst",
  "brocco.js"
];

FILES.forEach(function(filename) {
  var req = new XMLHttpRequest();
  req.open("GET", filename);
  req.onload = function() {
    FILE_CONTENTS[filename] = req.responseText;
    if (Object.keys(FILE_CONTENTS).length == FILES.length) {
      Brocco.document("brocco.js", FILE_CONTENTS["brocco.js"], {
        showdown: new Showdown.converter(),
        template: Brocco.template(FILE_CONTENTS["brocco.jst"]),
        highlightSyntax: function(language, code, cb) {
          var div = document.createElement('div');
          div.appendChild(document.createTextNode(code));
          var result = '<div class="highlight"><pre>' +
                       div.innerHTML +
                       '</pre></div>\n';
          var parts = result.split(language.dividerText);
          var html = parts.join('\n<span class="c">' + language.symbol + 
                                'DIVIDER</span>\n');
          setTimeout(function() {
            cb(html);
          }, 0);
        }
      }, function(html) {
        document.getElementById("docs").innerHTML = html;
      });
    }
  };
  req.send(null);
});
</script>
